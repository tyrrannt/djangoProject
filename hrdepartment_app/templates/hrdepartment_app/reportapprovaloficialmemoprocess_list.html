{% extends 'customers_app/main.html' %}
{% load static %}
{% load custom %}

{% block title %}
    <title>{{ title }}</title>
{% endblock %}

{% block content %}
    <style>
        .table-responsive {
            overflow-x: auto;
            position: relative;
        }
        .table-responsive th:first-child,
        .table-responsive td:first-child {
            position: sticky;
            left: 0;
            background-color: #fff;
            z-index: 1;
        }
    </style>
    <section role="main" class="content-body content-body-modern mt-0">

        {% include 'library_app/breadcrumb.html' %}

        <!-- start: page -->
        <div class="row">
            <div class="col">
                <div class="card card-modern">
                    <div class="card-body">
                        <div class="datatables-header-footer-wrapper">
                            <div class="datatable-header">
                                <div class="row align-items-center mb-3">
                                    <div class="col-sm-12 col-lg-4 mb-1">
                                        <select class="form-control select-style-1 filter-by" name="filter_month"
                                                id="id_filter_month">
                                            {% for key, value in month_dict.items %}
                                            <option value="{{ key }}" {% if current_year == value %}selected{% endif %}> {{ value }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-sm-12 col-lg-4 mb-1">
                                        <select class="form-control select-style-1 filter-by" name="filter_year"
                                                id="id_filter_year">
                                            {% for key, value in year_dict.items %}
                                            <option value="{{ key }}" {% if current_year == value %}selected{% endif %}> {{ value }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-sm-12 col-lg-4 mb-1">
                                        <button class="btn btn-primary" style="width: 100%" onclick="filter_date()">Сформировать</button>
                                    </div>
                                </div>
                            </div>
                            <div id="id_tables" class="table-responsive">
                                <table class="table table-ecommerce-simple table-striped mb-0" id="id_datatable"
                                       style="min-width: 1000px; display: block; height: 500px; overflow: auto;">
                                    <thead>
                                    <tr>
                                        <th width="14%" style="position: -webkit-sticky;  position: sticky;  top: -3px; z-index: 2; background: #ffffff"><span style="color: #0a53be;">ФИО</span></th>
                                        {% for item in table_count %}
                                            <th width="2%" style="position: -webkit-sticky;  position: sticky;  top: -3px; z-index: 2; background: #ffffff"><span style="color: #0a53be">{{ item }}</span></th>
                                        {% endfor %}
                                    </tr>
                                    </thead>
{#                                    <tbody>#}
{#                                    {% for key, value in table_set.items %}#}
{#                                        <tr>#}
{#                                            <td width="14%"><strong>{{ key }}</strong></td>#}
{#                                            {% for unit1, unit2 in value.items %}#}
{#                                                {% if unit == '1' %}#}
{#                                                    <td width="2%" style="background-color: #d2691e; border-color:#4670ad;border-style:dashed;border-width:1px;" fio="{{ key }}" title="" class="position-4-success"></td>#}
{#                                                {% elif unit == '2' %}#}
{#                                                    <td width="2%" style="background-color: #2b8101; border-color:#4670ad;border-style:dashed;border-width:1px;" class="position-4-success"></td>#}
{#                                                {% else %}#}
{#                                                    <td width="2%" style="background-color: #f5f5dc; border-color:#4670ad;border-style:dashed;border-width:1px;"></td>#}
{#                                                {% endif %}#}
{#                                            {% endfor %}#}
{#                                        </tr>#}
{#                                    {% endfor %}#}
{#                                    </tbody>#}
                                </table>
                            </div>
                            <hr class="solid mt-5 opacity-4">
                            <div class="datatable-footer">
                                <div class="row align-items-center justify-content-between mt-3">
                                    <div class="col-md-auto order-1 mb-3 mb-lg-0">
                                        <div class="d-flex align-items-stretch">
                                            {#                                            ToDo: Тут можно в подвал что то вывести #}
                                        </div>
                                    </div>
                                    <div class="col-lg-auto text-center order-3 order-lg-2">
                                        <div class="results-info-wrapper"></div>
                                    </div>
                                    <div class="col-lg-auto order-2 order-lg-3 mb-3 mb-lg-0">
                                        <div class="pagination-wrapper"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- end: page -->
    </section>
    <script type="text/javascript">
        function reloadScript() {
            console.log('Перезагрузка')
            $('#myAdminOrderScript').remove();
            $.getScript("{% static 'admin_templates/js/examples/report_card.js' %}", function() {
                $('script:last').attr('id', 'myAdminOrderScript');
            });
        };
        function filter_date() {
            current_year = $("#id_filter_year").val();
            current_month = $("#id_filter_month").val();
            $.ajax({
                type: "GET",
                url: '{% url 'hrdepartment_app:bpmemo_report' %}',
                data: {
                    "CY": current_year,
                    "CM": current_month,
                },
                dataType: "json",
                success: function (data) {
                    var ref = $('#id_tables').html('');
                    var ref = $('#id_tables').html(data);
                    if (data === 'ok') {
                        console.log("success");
                    }
                    reloadScript();
                },
                failure: function (data) {
                    console.log("failure");
                }
            });
        };
    </script>
{% endblock %}

{% block SpecificPageVendor %}
    <script id="myAdminOrderScript" src="{% static 'admin_templates/js/examples/report_card.js' %}"></script>
{#    <script src="{% static 'admin_templates/vendor/datatables/media/js/jquery.dataTables.min.js' %}"></script>#}
{#    <script src="{% static 'admin_templates/vendor/datatables/media/js/dataTables.bootstrap5.min.js' %}"></script>#}

{% endblock %}