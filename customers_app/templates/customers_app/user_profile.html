{% extends 'customers_app/main.html' %}
{% load static %}
{% load custom %}

{% block title %}
    <title>{{ title }}</title>
{% endblock %}

{% block custome_script %}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            {% for task in tasks %}
                {% if task.due_date and task.due_date|date:"Y-m-d" == today %}
                    toastr.warning('Задача "{{ task.title }}" скоро истекает!');
                {% endif %}
            {% endfor %}
        });
    </script>
    <script>
        (function ($) {

            'use strict';

            // Функция для инициализации перетаскивания событий
            var initCalendarDragNDrop = function () {
                var Draggable = FullCalendar.Draggable;

                // Инициализация перетаскивания для внешних событий
                $('#external-events div.external-event').each(function () {
                    new Draggable($(this)[0], {
                        itemSelector: '.external-event',
                        eventData: function (eventEl) {
                            var eventObj = $(eventEl).data('event');
                            return eventObj;
                        }
                    });
                });
            };

            // Функция для инициализации календаря
            var initCalendar = function () {
                var $calendar = $('#calendar');
                var date = new Date();
                var d = date.getDate();
                var m = date.getMonth();
                var y = date.getFullYear();

                // Определение вида календаря в зависимости от ширины экрана
                var initialView = $(window).width() < 768 ? 'timeGridDay' : 'dayGridMonth';

                // Создание экземпляра календаря
                var $calendarInstance = new FullCalendar.Calendar($calendar[0], {
                    themeSystem: 'bootstrap',
                    locale: 'ru',  // Устанавливаем русский язык
                    eventDisplay: 'block',
                    initialView: initialView, // Начальный вид: неделя с временной сеткой
                    eventOrder: ['start', 'priority'], // Сортировка по времени начала, затем по приоритету
                    // eventOverlap: false, // Запрещаем перекрытие событий
                    slotDuration: '01:00:00', // Интервалы в 1 час
                    slotLabelInterval: '01:00:00', // Метки на сетке каждый час
                    slotMinTime: '00:00:00', // Начало временной шкалы (8:00)
                    slotMaxTime: '23:59:59', // Конец временной шкалы (20:00)
                    slotLabelFormat: {
                        hour: '2-digit',
                        minute: '2-digit',
                        omitZeroMinute: false,
                        meridiem: 'short'
                    },
                    allDaySlot: false, // Скрыть слот "Весь день"
                    headerToolbar: {
                        start: 'prev,next today',
                        center: 'title',
                        end: $(window).width() < 768 ? 'timeGridDay' : 'timeGridDay,dayGridWeek,dayGridMonth' // Компактная панель для мобильных
                    },
                    bootstrapFontAwesome: {
                        close: 'fa-times',
                        prev: 'fa-caret-left',
                        next: 'fa-caret-right',
                        prevYear: 'fa-angle-double-left',
                        nextYear: 'fa-angle-double-right'
                    },
                    editable: true,
                    droppable: true, // Разрешаем перетаскивание событий
                    drop: function (info) { // Обработчик события перетаскивания
                        // Получаем данные о событии
                        var eventData = $(info.draggedEl).data('event');

                        // Отправляем AJAX-запрос на сервер для создания задачи
                        $.ajax({
                            url: "{% url 'tasks_app:task-create-ajax' %}",
                            type: "POST",
                            data: {
                                title: eventData.title,
                                start_date: new Date().toISOString(), // Устанавливаем текущую дату и время
                                end_date: moment().add(1, 'hours').format('YYYY-MM-DDTHH:mm'), // Добавляем 1 час к текущему времени
                                priority: eventData.priority, // Передаем приоритет
                                shared_with: $('#shared_with').val(), // Передаем выбранных пользователей
                                freq: 'daily',
                                csrfmiddlewaretoken: '{{ csrf_token }}'
                            },
                            success: function (response) {
                                // Добавляем созданную задачу в календарь
                                $calendarInstance.addEvent({
                                    id: response.id,
                                    title: response.title,
                                    start: response.start_date,
                                    end: response.end_date, // Добавляем end_date в календарь
                                    url: response.url,
                                    color: response.color // Используем цвет из ответа
                                });
                                console.log($('#shared_with').val());
                                toastr.success('Задача создана!');
                            },
                            error: function () {
                                toastr.error('Ошибка при создании задачи');
                            }
                        });

                        // Удаляем элемент, если чекбокс "Удалить после перетаскивания" отмечен
                        if ($('#RemoveAfterDrop').is(':checked')) {
                            info.draggedEl.parentNode.removeChild(info.draggedEl);
                        }
                    },
                    events: [
                        {% for task in repeat_tasks %}
                            {
                                id: '{{ task.id }}',
                                title: '{{ task.title|safe }}', // Используем иконку
                                rrule: {{ task.rrule|safe }},  // Передаем rrule как строку
                                url: '{{ task.url }}',
                                className: 'fc-event-{{ task.color }}'  // Используем приоритет как цвет
                            },
                        {% endfor %}
                    ],
                    eventContent: function (info) {
                        var title = info.event.title;
                        var div = document.createElement('div');
                        div.className = 'fc-event-title';
                        div.style.whiteSpace = 'normal'; // Разрешаем перенос строки
                        div.style.wordWrap = 'break-word'; // Перенос слов
                        div.style.overflow = 'hidden'; // Скрываем выходящий текст
                        div.style.textOverflow = 'ellipsis'; // Добавляем многоточие
                        div.innerHTML = title;
                        return {domNodes: [div]};
                    }
                });

                // Отрисовка календаря
                $calendarInstance.render();

                // Настройка кнопок календаря под Bootstrap
                var $calendarButtons = $calendar.find('.fc-header-right > span');
                $calendarButtons
                    .filter('.fc-button-prev, .fc-button-today, .fc-button-next')
                    .wrapAll('<div class="btn-group mt-sm mr-md mb-sm ml-sm"></div>')
                    .parent()
                    .after('<br class="hidden"/>');

                $calendarButtons
                    .not('.fc-button-prev, .fc-button-today, .fc-button-next')
                    .wrapAll('<div class="btn-group mb-sm mt-sm"></div>');

                $calendarButtons
                    .attr({'class': 'btn btn-sm btn-default'});
            };

            // Инициализация календаря и перетаскивания
            $(function () {
                initCalendar();
                initCalendarDragNDrop();
            });

            // Обработка изменения размера окна
            $(window).on('resize', function () {
                var $calendar = $('#calendar');
                var calendarInstance = $calendar.fullCalendar('getCalendar');
                var newView = $(window).width() < 768 ? 'timeGridDay' : 'dayGridMonth';
                calendarInstance.changeView(newView);
            });

        }).apply(this, [jQuery]);
    </script>
{% endblock %}

{% block content %}
    <section role="main" class="content-body">
        <!-- start: page -->
        <div class="row">
            <div class="col-lg-4 col-xl-3 mb-4 mb-xl-0">
                <section class="card">
                    {% include 'customers_app/block_personal_info.html' %}
                    <h1 id="app"></h1>
                    {% include 'customers_app/block_statistics.html' %}
                </section>
                {% if user.is_superuser %}
                    {#                    <section class="card">#}
                    {#                        <header class="card-header">#}
                    {#                            <div class="card-actions">#}
                    {#                                <a href="#" class="card-action card-action-toggle" data-card-toggle></a>#}
                    {#                                <a href="#" class="card-action card-action-dismiss" data-card-dismiss></a>#}
                    {#                            </div>#}
                    {##}
                    {#                            <h2 class="card-title">#}
                    {#                                <span class="badge badge-primary label-sm font-weight-normal va-middle me-3">298</span>#}
                    {#                                <span class="va-middle">Friends</span>#}
                    {#                            </h2>#}
                    {#                        </header>#}
                    {#                        <div class="card-body">#}
                    {#                            <div class="content">#}
                    {#                                <ul class="simple-user-list">#}
                    {#                                    <li>#}
                    {#                                        <figure class="image rounded">#}
                    {#                                            <img src="{% static 'admin_templates/img/!sample-user.jpg' %}"#}
                    {#                                                 alt="Joseph Doe Junior" class="rounded-circle">#}
                    {#                                        </figure>#}
                    {#                                        <span class="title">Joseph Doe Junior</span>#}
                    {#                                        <span class="message truncate">Lorem ipsum dolor sit.</span>#}
                    {#                                    </li>#}
                    {#                                </ul>#}
                    {#                                <hr class="dotted short">#}
                    {#                                <div class="text-end">#}
                    {#                                    <a class="text-uppercase text-muted" href="#">(View All)</a>#}
                    {#                                </div>#}
                    {#                            </div>#}
                    {#                        </div>#}
                    {#                        <div class="card-footer">#}
                    {#                            <div class="input-group">#}
                    {#                                <input type="text" class="form-control" name="s" id="s" placeholder="Поиск...">#}
                    {#                                <button class="btn btn-default" type="submit"><i class="bx bx-search"></i></button>#}
                    {#                            </div>#}
                    {#                        </div>#}
                    {#                    </section>#}
                    {##}
                    {#                    <section class="card">#}
                    {#                        <header class="card-header">#}
                    {#                            <div class="card-actions">#}
                    {#                                <a href="#" class="card-action card-action-toggle" data-card-toggle></a>#}
                    {#                                <a href="#" class="card-action card-action-dismiss" data-card-dismiss></a>#}
                    {#                            </div>#}
                    {##}
                    {#                            <h2 class="card-title">Popular Posts</h2>#}
                    {#                        </header>#}
                    {#                        <div class="card-body">#}
                    {#                            <ul class="simple-post-list">#}
                    {#                                <li>#}
                    {#                                    <div class="post-image">#}
                    {#                                        <div class="img-thumbnail">#}
                    {#                                            <a href="#">#}
                    {#                                                <img src="{% static 'admin_templates/img/post-thumb-1.jpg' %}" alt="">#}
                    {#                                            </a>#}
                    {#                                        </div>#}
                    {#                                    </div>#}
                    {#                                    <div class="post-info">#}
                    {#                                        <a href="#">Nullam Vitae Nibh Un Odiosters</a>#}
                    {#                                        <div class="post-meta">#}
                    {#                                            Jan 10, 2021#}
                    {#                                        </div>#}
                    {#                                    </div>#}
                    {#                                </li>#}
                    {#                                <li>#}
                    {#                                    <div class="post-image">#}
                    {#                                        <div class="img-thumbnail">#}
                    {#                                            <a href="#">#}
                    {#                                                <img src="{% static 'admin_templates/img/post-thumb-2.jpg' %}" alt="">#}
                    {#                                            </a>#}
                    {#                                        </div>#}
                    {#                                    </div>#}
                    {#                                    <div class="post-info">#}
                    {#                                        <a href="#">Vitae Nibh Un Odiosters</a>#}
                    {#                                        <div class="post-meta">#}
                    {#                                            Jan 10, 2021#}
                    {#                                        </div>#}
                    {#                                    </div>#}
                    {#                                </li>#}
                    {#                                <li>#}
                    {#                                    <div class="post-image">#}
                    {#                                        <div class="img-thumbnail">#}
                    {#                                            <a href="#">#}
                    {#                                                <img src="{% static 'admin_templates/img/post-thumb-3.jpg' %}" alt="">#}
                    {#                                            </a>#}
                    {#                                        </div>#}
                    {#                                    </div>#}
                    {#                                    <div class="post-info">#}
                    {#                                        <a href="#">Odiosters Nullam Vitae</a>#}
                    {#                                        <div class="post-meta">#}
                    {#                                            Jan 10, 2021#}
                    {#                                        </div>#}
                    {#                                    </div>#}
                    {#                                </li>#}
                    {#                            </ul>#}
                    {#                        </div>#}
                    {#                    </section>#}
                {% endif %}
            </div>
            <div class="col-lg-8">

                <div class="tabs">
                    <ul class="nav nav-tabs tabs-primary">
                        <li class="nav-item active">
                            <button class="nav-link" data-bs-target="#tasks" data-bs-toggle="tab">Планировщик событий
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-bs-target="#overview" data-bs-toggle="tab">Лента событий
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-bs-target="#calculation" data-bs-toggle="tab">Расчетный
                                листок
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-bs-target="#reportcard" data-bs-toggle="tab">Учет рабочего
                                времени
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-bs-target="#vacation" data-bs-toggle="tab">Отпуск
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-bs-target="#sout" data-bs-toggle="tab">СОУТ
                            </button>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div id="tasks" class="tab-pane active">
                            <div class="p-3">
                                <div id="calendar"></div>
                            </div>
                        </div>
                        <div id="overview" class="tab-pane">
                            <div class="p-3">
                                <a href="{% url 'customers_app:post_add' %}" class="btn btn-outline-primary btn-px-4 py-3
                                                align-items-left font-weight-semibold line-height-1">
                                    <i class='bx bx-list-plus text-4 me-2'></i> Добавить</a>
                                <h4 class="mb-3 pt-4 font-weight-semibold text-dark">Хронология</h4>
                                <div class="timeline timeline-simple mt-3 mb-3">
                                    <div class="tm-body">

                                        <ol class="tm-items">

                                            {# ToDo: Доработать вывод постов#}
                                            {% for item in post_high %}
                                                {% if item.allowed_placed %}
                                                    <li>
                                                        <div class="tm-box">
                                                            <p class="text-muted mb-0">123</p>
                                                            {% if item.post_date_start %}
                                                                <p class="text-muted mb-0">{{ item.post_date_start }}</p>
                                                            {% else %}
                                                                <p class="text-muted mb-0">{{ item.creation_date }}</p>
                                                            {% endif %}
                                                            <p>{{ item.post_description | safe }}</p>
                                                            <p class="text-danger mb-0">
                                                                Ответственный: {{ item.responsible }}</p>
                                                            {% if user == item.responsible %}
                                                                <a href="{% url 'customers_app:post_update' item.pk %}">Изменить</a>
                                                            {% endif %}
                                                        </div>
                                                    </li>
                                                {% endif %}
                                            {% endfor %}
                                        </ol>
                                        <div class="tm-title">
                                            <h5 class="m-0 pt-2 pb-2 text-dark font-weight-semibold text-uppercase">
                                                {% now "d - m - Y г." %}</h5>
                                        </div>
                                        <ol class="tm-items">
                                            {# ToDo: Доработать вывод постов#}
                                            {% for item in post_low %}
                                                {% if item.allowed_placed %}
                                                    <li>
                                                        <div class="tm-box">
                                                            {% if item.post_date_start %}
                                                                <p class="text-muted mb-0">{{ item.post_date_start }}</p>
                                                            {% else %}
                                                                <p class="text-muted mb-0">{{ item.creation_date }}</p>
                                                            {% endif %}
                                                            <p>{{ item.post_description | safe }}</p>
                                                            <p class="text-danger mb-0">
                                                                Ответственный: {{ item.responsible }}</p>
                                                            {% if user == item.responsible %}
                                                                <a href="{% url 'customers_app:post_update' item.pk %}">Изменить</a>
                                                            {% endif %}
                                                        </div>
                                                    </li>
                                                {% endif %}
                                            {% endfor %}
                                        </ol>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div id="calculation" class="tab-pane">
                            <div class="p-3">
                                <div class="row">
                                    <div class="col-sm-12 col-md-6 col-lg-3">
                                        <select class="form-control select-style-1 filter-by" name="filter_month"
                                                id="id_filter_month">
                                            {% for key, value in month_dict.items %}
                                                <option value="{{ key }}"
                                                        {% if current_month == key %}selected{% endif %}> {{ value }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-sm-12 col-md-6 col-lg-3">
                                        <select class="form-control select-style-1 filter-by" name="filter_year"
                                                id="id_filter_year">
                                            {% for key, value in year_dict.items %}
                                                <option value="{{ key }}"
                                                        {% if current_year == key %}selected{% endif %}> {{ value }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-sm-12 col-md-6 col-lg-3">
                                        <input class="form-control" type="password" id="id_pxmx" value="">
                                    </div>
                                    <div class="col-sm-12 col-md-6 col-lg-3">
                                        <button class="btn btn-outline-primary" style="width: 100%"
                                                onclick="filter_date()"><i class='bx bxs-file-find text-4 me-2'></i>
                                            Сформировать
                                        </button>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="row">

                                    </div>
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div id="id_accrued">

                                            </div>
                                        </div>
                                    </div>
                                    <hr>
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div id="id_withheld">

                                            </div>
                                        </div>
                                    </div>
                                    <hr>
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div id="id_paid">

                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div id="reportcard" class="tab-pane">
                            <div class="p-3">
                                <div class="row">
                                    <div class="col-sm-12 col-md-6 col-lg-3 mb-1">
                                        <select class="form-control select-style-1 filter-by" name="report_month"
                                                id="id_report_month">
                                            {% for key, value in month_dict.items %}
                                                <option value="{{ key }}"
                                                        {% if current_month == key %}selected{% endif %}> {{ value }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-sm-12 col-md-6 col-lg-3 mb-1">
                                        <select class="form-control select-style-1 filter-by" name="report_year"
                                                id="id_report_year">
                                            {% for key, value in year_dict.items %}
                                                <option value="{{ key }}"
                                                        {% if current_year == key %}selected{% endif %}> {{ value }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-sm-12 col-md-6 col-lg-3 mb-1">
                                        <button class="btn btn-outline-primary" style="width: 100%"
                                                onclick="report_date()">
                                            <i class='bx bxs-file-find text-4 me-2'></i> Сформировать
                                        </button>
                                    </div>
                                    <div class="col-sm-12 col-md-6 col-lg-3 mb-1">
                                        <button class="btn btn-outline-info" style="width: 100%"
                                                onclick="window.location.href='{% url 'hrdepartment_app:reportcard_list' %}';">
                                            <i class='bx bxs-book-content text-4 me-2'></i> Журнал
                                        </button>
                                    </div>
                                </div>
                                <style>
                                    /* Применяем к таблице с id="my_table_id" */
                                    #my_table_id {
                                        width: 100%; /* Таблица занимает всю доступную ширину */
                                        border-collapse: collapse; /* Убираем отступы между ячейками */
                                    }

                                    /* Выравниваем содержимое всех ячеек по правому краю */
                                    #my_table_id th,
                                    #my_table_id td {
                                        text-align: right;
                                        tab-size: 14px;
                                        padding: 8px; /* Добавляем отступы внутри ячеек */
                                    }

                                    /* Выравниваем заголовки по левому краю */
                                    #my_table_id th {
                                        text-align: right;
                                    }

                                    /* Дополнительные стили для итоговой строки */
                                    /* Выделяем последнюю строку жирным шрифтом и добавляем жирную рамку */
                                    #my_table_id tr:last-child td {
                                        font-weight: bold;
                                        border-top: 2px solid black; /* Жирная рамка вокруг последней строки */
                                    }

                                    #my_table_id tr:first-child td {
                                        border-top: 2px solid black; /* Жирная рамка вокруг последней строки */
                                    }

                                    /* Стили для выделения текста в зависимости от значения */
                                    .positive {
                                        font-weight: bold;
                                        color: #116500;
                                    }

                                    .negative {
                                        font-weight: bold;
                                        color: red;
                                    }

                                    /* Стили для строк с определенными значениями в колонке "Тип" */
                                    .type-В {
                                        color: #0a001f;
                                    }

                                    .type-П {
                                        font-weight: bold;
                                        color: #0b7a00; /* Другой цвет фона */
                                    }
                                </style>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div id="id_report" class="table-responsive">

                                        </div>
                                    </div>
                                </div>
                                <hr>
                                {#                                <div class="row">#}
                                {#                                        <div class="col-sm-12">#}
                                {#                                            <p>Обозначение цветов:<br>#}
                                {#                                            <strong><span style="color: #0c00ad">Синий</span></strong> - Отпуска;<br>#}
                                {#                                            <strong><span style="color: #000000">Черный</span></strong> - Явка;<br>#}
                                {#                                            <strong><span>--//--</span></strong> - Уход не зарегистрирован;<br>#}
                                {#                                            <strong><span style="color: #ff0000">Красный</span></strong> - Недоработка;<br>#}
                                {#                                            <strong><span style="background-color: #b0ffd5">Зеленый фон</span></strong> - Несколько интервалов за день.</p>#}
                                {#                                            <p>Сокращения:<br>#}
                                {#                                            <strong><span>Я&nbsp;-&nbsp;Явка; СП&nbsp;-&nbsp;Служебная поездка; К&nbsp;-&nbsp;Командировка; О&nbsp;-&nbsp;Отпуск; Б&nbsp;-&nbsp;Больничный; М&nbsp;-&nbsp;Мед осмотр; В&nbsp;-&nbsp;Выходной; П&nbsp;-&nbsp;Праздник; </span><span style="color: #ff0000">Н&nbsp;-&nbsp;Отсутствие.</span></strong><br>#}
                                {#                                        </div>#}
                                {#                                </div>#}
                            </div>
                        </div>
                        <div id="sout" class="tab-pane">
                            <div class="p-3">
                                <div class="row">
                                    <h4>Тут будет размещаться специальная оценка условий труда.</h4>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12 col-md-6 col-lg-3">

                                    </div>
                                    <div class="col-sm-12 col-md-6 col-lg-3">

                                    </div>
                                    <div class="col-sm-12 col-md-6 col-lg-3">

                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div id="id_report" class="table-responsive">

                                        </div>
                                    </div>
                                </div>
                                <hr>

                            </div>
                        </div>
                        <div id="vacation" class="tab-pane">
                            <div class="p-3">
                                <h5>Данные пока могут содержать не точную информацию. Раздел в разработке!</h5>
                                <div class="row">
                                    <div class="col-sm-12 col-md-6 col-lg-3 mb-1">
                                        <h4>Выберите дату:</h4>
                                    </div>
                                    <div class="col-sm-12 col-md-6 col-lg-3 mb-1">
                                        <input class="form-control form-control-modern" type="date" min="2023-01-01"
                                               id="id_vacation_date" name="vacation_date"/>
                                    </div>
                                    <div class="col-sm-12 col-md-6 col-lg-3 mb-1">
                                        <button class="btn btn-outline-primary" style="width: 100%"
                                                onclick="report_vacation()">
                                            <i class='bx bxs-file-find text-4 me-2'></i> Сформировать
                                        </button>
                                    </div>
                                </div>
                                <div class="row">

                                    <div class="col-sm-12" id="id_days">

                                    </div>

                                </div>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div id="id_report" class="table-responsive">

                                        </div>
                                    </div>
                                </div>
                                <hr>

                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>
        <!-- end: page -->
    </section>
    <script type="text/javascript">
        function filter_date() {
            current_year = $("#id_filter_year").val();
            current_month = $("#id_filter_month").val();
            pxmp = $("#id_pxmx").val()
            $.ajax({
                type: "GET",
                url: '{% url 'customers_app:profile' user.pk %}',
                data: {
                    "CY": current_year,
                    "CM": current_month,
                    "PX": pxmp,
                },
                dataType: "json",
                success: function (data) {
                    var ref = $('#id_accrued').html('');
                    var ref = $('#id_accrued').html(data[0]);
                    var ref = $('#id_withheld').html('');
                    var ref = $('#id_withheld').html(data[1]);
                    var ref = $('#id_paid').html('');
                    var ref = $('#id_paid').html(data[2]);
                    var ref = $('#id_pxmx').val('')
                    if (data === 'ok') {
                        console.log("success");
                    }
                },
                failure: function (data) {
                    console.log("failure");
                }
            });
        }

        function applyStyles() {
            const table = document.getElementById('my_table_id');
            if (!table) return; // Прекращаем выполнение, если таблицы нет
            const rows = table.getElementsByTagName('tr');

            for (let i = 1; i < rows.length; i++) { // Начинаем с 1, чтобы пропустить заголовок
                const cells = rows[i].getElementsByTagName('td');
                const valueCell = cells[2]; // Предполагаем, что значение находится в третьей ячейке
                const typeCell = cells[3]; // Предполагаем, что значение "Тип" находится в четвертой ячейке

                if (valueCell) {
                    const value = valueCell.textContent.trim();

                    // Очищаем предыдущие классы
                    rows[i].classList.remove('positive', 'negative');

                    // Применяем класс в зависимости от значения
                    if (value.startsWith('-')) {
                        rows[i].classList.add('negative');
                    } else {
                        rows[i].classList.add('positive');
                    }
                }

                if (typeCell) {
                    const type = typeCell.textContent.trim();

                    // Очищаем предыдущие классы
                    rows[i].classList.remove('type-В', 'type-П');

                    // Применяем класс в зависимости от значения "Тип"
                    if (type === 'Выходной') {
                        rows[i].classList.remove('positive', 'negative');
                        rows[i].classList.add('type-В', 'table-secondary');
                    } else if (type === 'Праздничный день') {
                        rows[i].classList.remove('positive', 'negative');
                        rows[i].classList.add('type-П', 'table-primary');
                    }
                }
            }
        }

        function report_date() {
            report_year = $("#id_report_year").val();
            report_month = $("#id_report_month").val();
            $.ajax({
                type: "GET",
                url: '{% url 'customers_app:profile' user.pk %}',
                data: {
                    "RY": report_year,
                    "RM": report_month,
                },
                dataType: "json",
                success: function (data) {
                    var ref = $('#id_report').html('');
                    var ref = $('#id_report').html(data);

                    if (data === 'ok') {
                        console.log("success");
                    }
                    applyStyles();
                },
                failure: function (data) {
                    console.log("failure");
                }
            });
        }

        function report_vacation() {
            vacation_date = $("#id_vacation_date").val();
            $.ajax({
                type: "GET",
                url: '{% url 'customers_app:profile' user.pk %}',
                data: {
                    "GD": vacation_date,
                },
                dataType: "json",
                success: function (data) {
                    var ref = $('#id_days').html('');
                    var ref = $('#id_days').html(data);

                    if (data === 'ok') {
                        console.log("success");
                    }
                },
                failure: function (data) {
                    console.log("failure");
                }
            });
        }
    </script>
{% endblock %}
