<!-- templates/contracts_app/contract_report.html -->

{% extends 'customers_app/main.html' %}
{% block content %}
    <section role="main" class="content-body">
        <form method="get" class="mb-4">
            <label>–ü–µ—Ä–∏–æ–¥:</label>
            <input type="date" name="start" value="{{ start_date }}">
            <input type="date" name="end" value="{{ end_date }}">
            <button type="submit" class="btn btn-primary">–ü–æ–∫–∞–∑–∞—Ç—å</button>
        </form>
        {% if start_date and end_date %}
            <a href="{% url 'contracts_app:export_contracts_excel' %}?start={{ start_date | date:'d.m.Y' }}&end={{ end_date | date:'d.m.Y' }}"
               class="btn btn-success mb-4">
                üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
            </a>
        {% endif %}

        <h2>–û—Ç—á—ë—Ç –ø–æ –¥–æ–≥–æ–≤–æ—Ä–∞–º —Å {{ start_date }} –ø–æ {{ end_date }}</h2>

        {% if error %}
            <p style="color: red">{{ error }}</p>
        {% endif %}

        {% if grouped_contracts %}
            <ul class="list-group">
                {% for parent, contracts in grouped_contracts.items %}
                    <li class="list-group-item">
                        <details>
                            <summary>
                                <strong>{{ parent.contract_number|default:"(–ë–µ–∑ –Ω–æ–º–µ—Ä–∞)" }}</strong>
                                ‚Äî {{ parent.contract_counteragent }}
                            </summary>
                            <ul class="list-group mt-2">
                                {% for contract in contracts %}
                                    <li class="list-group-item">
                                        <div><strong>–ù–æ–º–µ—Ä:</strong> {{ contract.contract_number|default:"-" }}</div>
                                        <div><strong>–î–∞—Ç–∞:</strong> {{ contract.date_conclusion }}</div>
                                        <div><strong>–¢–∏–ø:</strong> {{ contract.type_of_document }}</div>
                                        <div><strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</strong> {{ contract.comment|default:"-" }}</div>
                                    </li>
                                {% endfor %}
                            </ul>
                        </details>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>–ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>
        {% endif %}
    </section>
{% endblock %}
