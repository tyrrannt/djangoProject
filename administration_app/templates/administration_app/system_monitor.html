{% extends 'customers_app/main.html' %}
{% load static %}
{% load custom %}

{% block title %}
    <title>{{ title }}</title>
{% endblock %}

{% block custome_css %}
<title>Мониторинг сервера</title>
{#  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/css/bootstrap.min.css">#}
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery.easy-pie-chart/2.1.6/jquery.easy-pie-chart.min.css">
  <style>
    .card {
      margin-bottom: 20px;
    }
    .chart {
      text-align: center;
      margin-top: 20px;
    }
  </style>
{% endblock %}

{% block custome_script %}
    <script src="{% static 'admin_templates/vendor/jquery.easy-pie-chart/jquery.easypiechart.min.js' %}"></script>
    <script>
    $(function() {
      $('#cpu-chart').easyPieChart({
        barColor: '#2ecc71',
        trackColor: '#e6e6e6',
        scaleColor: false,
        lineWidth: 10,
        lineCap: 'round',
        size: 160,
        animate: 1000
      });

      $('#memory-chart').easyPieChart({
        barColor: '#3498db',
        trackColor: '#e6e6e6',
        scaleColor: false,
        lineWidth: 10,
        lineCap: 'round',
        size: 160,
        animate: 1000
      });

      const ws = new WebSocket('wss://' + window.location.host + '/ws/monitor/');

      ws.onmessage = function(event) {
        const data = JSON.parse(event.data);
        $('#cpu-chart').data('easyPieChart').update(data.cpu_percent);
        $('#cpu-chart span').text(data.cpu_percent);
        $('#memory-chart').data('easyPieChart').update(data.memory_percent);
        $('#memory-chart span').text(data.memory_percent);
      };
    });
  </script>
{% endblock %}

{% block content %}
    <section role="main" class="content-body content-body-modern mt-0">

        {% include 'library_app/breadcrumb.html' %}

        <!-- start: page -->
        <div class="container">
    <h1 class="mt-4">Мониторинг сервера</h1>
    <section class="card">
      <header class="card-header">
        <div class="card-actions">
          <a href="#" class="card-action card-action-toggle" data-card-toggle></a>
          <a href="#" class="card-action card-action-dismiss" data-card-dismiss></a>
        </div>
        <h2 class="card-title">Использование сервера</h2>
{#        <p class="card-subtitle">В шаблоне администратора Porto легко создавать собственные графики. Вы можете использовать несколько типов графиков.</p>#}
      </header>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <div class="chart" id="cpu-chart" data-percent="0"><span>0</span>%</div>
            <h4 class="text-center">Использование ЦП</h4>
          </div>
          <div class="col-md-6">
            <div class="chart" id="memory-chart" data-percent="0"><span>0</span>%</div>
            <h4 class="text-center">Использование памяти</h4>
          </div>
        </div>
      </div>
    </section>
  </div>

        
  
        <!-- end: page -->
    </section>

{% endblock %}
